---
- name: Enforce Password Complexity and Sync Their Times
  hosts: all
  tasks:
    #Enforce Password Complexity Windows
    - name: Enforce password complexity policy on Windows
      ansible.windows.win_regedit:
        path: HKLM:\SYSTEM\CurrentControlSet\Services\Netlogon\Parameters
        name: PasswordComplexity
        data: 1
        type: dword
        state: present
      when: ansible_os_family == "Windows"
      register: password_complexity_result

    - name: Verify password complexity Windows
      ansible.windows.win_shell: |
        Get-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Services\Netlogon\Parameters" -Name "PasswordComplexity"
      when: ansible_os_family == "Windows"
      register: verify_password_complexity

    - name: Display password complexity verification
      ansible.builtin.debug:
        var: verify_password_complexity.stdout_lines
      when: ansible_os_family == "Windows"

    #Configure NTP Client Linux Servers
    - name: Install NTP package on Linux servers
      ansible.builtin.yum:
        name: ntp
        state: present
      when: ansible_os_family == "RedHat"

    - name: Configure NTP client Linux
      ansible.builtin.template:
        src: ntp.conf.j2
        dest: /etc/ntp.conf
        owner: root
        group: root
        mode: '0644'
      when: ansible_os_family == "RedHat"

    - name: Restart NTP service Linux
      ansible.builtin.service:
        name: ntpd
        state: restarted
        enabled: yes
      when: ansible_os_family == "RedHat"

    #Sync Time with Domain Controller Windows
    - name: Sync time with domain controller
      ansible.windows.win_shell: |
        w32tm /resync
      when: ansible_os_family == "Windows"
      register: time_sync_result

    - name: Display time sync result Windows
      ansible.builtin.debug:
        var: time_sync_result.stdout_lines
      when: ansible_os_family == "Windows"
