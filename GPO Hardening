---
- name: Set Minimum Password Length and Disable USB Storage
  hosts: [windows]
  tasks:
    - name: Set Minimum Password Length to 12 characters
      ansible.windows.win_shell: |
        Set-ADDefaultDomainPasswordPolicy -Identity (Get-ADDomain).DistinguishedName -MinPasswordLength 12
      register: password_length_result

    - name: Display Password Length Result
      ansible.builtin.debug:
        var: password_length_result.stdout_lines

    - name: Verify Minimum Password Length
      ansible.windows.win_shell: |
        (Get-ADDefaultDomainPasswordPolicy).MinPasswordLength
      register: verify_password_length

    - name: Display Verification Result
      ansible.builtin.debug:
        var: verify_password_length.stdout_lines

    - name: Disable USB Storage Devices
      ansible.windows.win_regedit:
        path: HKLM:\SYSTEM\CurrentControlSet\Services\USBSTOR
        name: Start
        data: 4
        type: dword

    - name: Verify USB Storage Devices Disabled
      ansible.windows.win_shell: |
        Get-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Services\USBSTOR" -Name "Start"
      register: verify_usb_disabled

    - name: Display USB Disabled Verification Result
      ansible.builtin.debug:
        var: verify_usb_disabled.stdout_lines
